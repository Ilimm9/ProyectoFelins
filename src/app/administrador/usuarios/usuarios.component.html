<!-- Container fluid -->
<div class="bg-primary pt-20 pb-21"></div>
<div class="container-fluid mt-n22 px-6">
  <div class="row">
    <div class="col-lg-12 col-md-12 col-12">
      <!-- Page header -->
      <div>
        <div class="d-flex justify-content-between align-items-center">
          <div class="mb-2 mb-lg-0">
            <h3 class="mb-0 text-white">
              Empleados | Clientes | Departamentos
            </h3>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-4 col-lg-6 col-md-12 col-12 mt-6">
      <!-- card -->
      <div class="card">
        <!-- card body -->
        <div class="card-body">
          <!-- heading -->
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <h4 class="mb-0">Total Empleados</h4>
            </div>
            <div
              class="icon-shape icon-md bg-light-primary text-primary rounded-2"
            >
              <i class="bi bi-briefcase fs-4"></i>
            </div>
          </div>
          <!-- project number -->
          <div>
            <h1 class="fw-bold">{{ empleados.length }}</h1>
            <p class="mb-0">{{ empleadosActivos() }} activos</p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-4 col-lg-6 col-md-12 col-12 mt-6">
      <!-- card -->
      <div class="card">
        <!-- card body -->
        <div class="card-body">
          <!-- heading -->
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <h4 class="mb-0">Total Clientes</h4>
            </div>
            <div
              class="icon-shape icon-md bg-light-primary text-primary rounded-2"
            >
              <i class="bi bi-people fs-4"></i>
            </div>
          </div>
          <!-- project number -->
          <div>
            <h1 class="fw-bold">{{ clientes.length }}</h1>
            <p class="mb-0">{{ comprasTotales() }} ordenes realizadas</p>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xl-4 col-lg-6 col-md-12 col-12 mt-6">
      <!-- card -->
      <div class="card">
        <!-- card body -->
        <div class="card-body">
          <!-- heading -->
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <h4 class="mb-0">Total Departamentos</h4>
            </div>
            <div
              class="icon-shape icon-md bg-light-primary text-primary rounded-2"
            >
              <i class="bi bi-bullseye fs-4"></i>
            </div>
          </div>
          <!-- project number -->
          <div>
            <h1 class="fw-bold">{{ departamentos.length }}</h1>
            <p class="mb-0">Actual: Administracion</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- row  -->
  <div class="row mt-6">
    <div class="col-md-12 col-12">
      <!-- card  -->
      <section id="Empleados">
        <div class="card">
          <div class="card-header bg-white py-4 d-flex justify-content-between">
            <div class="mt-2">
              <h4>
                <i class="fa-solid fa-users mx-2"></i> Listado de Empleados
              </h4>
            </div>
            @if(tabla === 'empleado'){
            <div>
              <jjwins-alert-messages> </jjwins-alert-messages>
            </div>
            }

            <div class="ml-auto">
              <a
                class="btn btn-primary"
                data-bs-toggle="modal"
                data-bs-target="#editarEmpleado"
              >
                <i class="fa-solid fa-plus"></i> Agregar
              </a>
            </div>
          </div>
          <div class="table-responsive">
            <table class="table table-nowrap">
              <thead class="table-light">
                <tr>
                  <th>Curp</th>
                  <th>Nombre</th>
                  <th>Email</th>
                  <th>telefono</th>
                  <th>Departamento</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                @for (empleado of empleados; track empleado) {
                @if(empleado.activo){
                <tr>
                  <td>{{ empleado.curp }}</td>
                  <td>
                    {{ empleado.nombre }} {{ empleado.apPaterno }}
                    {{ empleado.apMaterno }}
                  </td>
                  <td>{{ empleado.email }}</td>
                  <td>{{ empleado.telefono }}</td>
                  <td>{{ empleado.departamento.nombre }}</td>
                  <td>
                    <a
                      class="btn btn-primary my-2 mx-2"
                      data-bs-toggle="modal"
                      data-bs-target="#editarEmpleado"
                      (click)="cargarEmpleado(empleado.curp)"
                    >
                      <i class="fas fa-angle-double-right"></i> Editar
                    </a>
                  </td>
                </tr>
                } }
              </tbody>
            </table>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- row  -->
  <div class="row my-6">
    <!-- card  -->
    <div class="col-xl-8 col-lg-12 col-md-12 col-12">
      <div class="card h-100">
        <div class="card-header bg-white py-4 d-flex justify-content-between">
          <div class="mt-2">
            <h4><i class="fa-solid fa-users mx-2"></i> Listado de Clientes</h4>
          </div>
          @if(tabla === 'cliente'){
          <div>
            <jjwins-alert-messages> </jjwins-alert-messages>
          </div>
          }
          <div class="ml-auto">
            <a
              class="btn btn-primary"
              data-bs-toggle="modal"
              data-bs-target="#editarCliente"
            >
              <i class="fa-solid fa-plus"></i> Agregar
            </a>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-nowrap">
            <thead class="table-light">
              <tr>
                <th>Curp</th>
                <th>Nombre</th>
                <th>Email</th>
                <th>telefono</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              @for (cliente of clientes; track cliente) {
              <tr>
                <td>{{ cliente.curp }}</td>
                <td>
                  {{ cliente.nombre }} {{ cliente.apPaterno }}
                  {{ cliente.apMaterno }}
                </td>
                <td>{{ cliente.email }}</td>
                <td>{{ cliente.telefono }}</td>
                <td>
                  <a
                    class="btn btn-primary mx-2 my-2"
                    data-bs-toggle="modal"
                    data-bs-target="#editarCliente"
                    (click)="cargarCliente(cliente.curp)"
                  >
                    <i class="fas fa-angle-double-right"></i> Editar
                  </a>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="col-xl-4 col-lg-12 col-md-12 col-12 mb-6 mb-xl-0">
      <!-- card  -->
      <div class="card h-100">
        <div class="card-header bg-white py-4 d-flex justify-content-between">
          <div class="mt-2">
            <h4>
              <i class="fa-solid fa-building"></i> Listado de Departamentos
            </h4>
          </div>
          @if(tabla === 'departamento'){
          <div>
            <jjwins-alert-messages> </jjwins-alert-messages>
          </div>
          }
          <div class="ml-auto">
            <a
              class="btn btn-primary"
              data-bs-toggle="modal"
              data-bs-target="#editarDepto"
            >
              <i class="fa-solid fa-plus"></i> Agregar
            </a>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-nowrap">
            <thead class="table-light">
              <tr>
                <th>Nombre</th>
                <th>Descripcion</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              @for (depto of departamentos; track depto) {
              <tr>
                <td>{{ depto.nombre }}</td>
                <td>{{ depto.descripcion }}</td>
                <td>
                  <a
                    class="btn btn-primary m-2"
                    data-bs-toggle="modal"
                    data-bs-target="#editarDepto"
                    (click)="cargarDepto(depto.nombre)"
                  >
                    <i class="fas fa-angle-double-right"></i> Editar
                  </a>
                </td>
              </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal para Empleados -->
<div
  class="modal fade"
  id="editarEmpleado"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
  (hidden.bs.modal)="inicilizarDatosEmpleado()"
>
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        @if(mdEmpleado === 'agregar'){
        <h1 class="modal-title fs-5" id="exampleModalLabel">
          Agregar Empleado
        </h1>
        } @else {
        <h1 class="modal-title fs-5" id="exampleModalLabel">Editar Empleado</h1>
        }

        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
          #botonCerrarEmpleado
        ></button>
      </div>
      <div class="modal-body">
        <form #empleadoForm="ngForm" (ngSubmit)="accionEmpleado(empleadoForm)">
          @if(mdEmpleado === 'agregar'){
          <div class="mb-3">
            <label for="curp-add" class="form-label">Curp</label>
            <input
              type="text"
              class="form-control"
              id="curp-add"
              name="curp"
              required
              [(ngModel)]="empleado.curp"
            />
          </div>
          } @else {
          <div class="mb-3">
            <label for="curp-update" class="form-label">Curp</label>
            <input
              type="text"
              class="form-control"
              id="curp-update"
              name="curp"
              required
              [(ngModel)]="empleado.curp"
              disabled
            />
          </div>
          }

          <div class="mb-3">
            <label for="nombre" class="form-label">Nombre</label>
            <input
              type="text"
              class="form-control"
              id="nombre"
              name="nombre"
              required
              [(ngModel)]="empleado.nombre"
            />
          </div>
          <div class="mb-3">
            <label for="apPaterno" class="form-label">Apellido Paterno</label>
            <input
              type="text"
              class="form-control"
              id="apPaterno"
              name="apPaterno"
              required
              [(ngModel)]="empleado.apPaterno"
            />
          </div>
          <div class="mb-3">
            <label for="apMaterno" class="form-label">Apellido Materno</label>
            <input
              type="text"
              class="form-control"
              id="apMaterno"
              name="apMaterno"
              required
              [(ngModel)]="empleado.apMaterno"
            />
          </div>
          <div class="mb-3">
            <label for="domicilioActual" class="form-label"
              >Domicilio Actual</label
            >
            <input
              type="text"
              class="form-control"
              id="domicilioActual"
              name="domicilio"
              required
              [(ngModel)]="empleado.domicilio"
            />
          </div>
          <div class="mb-3">
            <label for="telefono" class="form-label">Teléfono</label>
            <input
              type="tel"
              class="form-control"
              id="telefono"
              name="telefono"
              [(ngModel)]="empleado.telefono"
            />
          </div>
          <div class="mb-3">
            <label for="email" class="form-label">Correo Electrónico</label>
            <input
              type="email"
              class="form-control"
              id="email"
              name="email"
              [(ngModel)]="empleado.email"
            />
          </div>
          <div class="mb-3">
            <label for="usuario" class="form-label">Usuario</label>
            <input
              type="text"
              class="form-control"
              id="usuario"
              name="usuario"
              [(ngModel)]="empleado.usuario"
            />
          </div>
          <div class="mb-3">
            <label for="password-1" class="form-label">Contraseña</label>
            <input
              type="password"
              class="form-control"
              id="password-1"
              name="password"
              [(ngModel)]="empleado.password"
            />
          </div>
          <div class="mb-3">
            <label for="fechaAlta" class="form-label">Fecha de Alta</label>
            <input
              type="text"
              class="form-control"
              id="fechaAlta"
              name="fechaAlta"
              [(ngModel)]="empleado.fechaAlta"
            />
          </div>
          <div class="mb-3">
            <label for="id-depto" class="form-label"
              >Nombre de departamento</label
            >
            <input
              type="text"
              class="form-control"
              id="idDepto"
              required
              name="departamento"
              [(ngModel)]="empleado.departamento.nombre"
            />
          </div>
          <div class="mb-3 form-check">
            <input
              type="checkbox"
              class="form-check-input"
              id="activo"
              name="activo"
              [(ngModel)]="empleado.activo"
            />
            <label class="form-check-label" for="activo">Activo</label>
          </div>

          @if(mdEmpleado !== 'agregar'){

          <div class="my-5">
            <div class="mx-auto w-100">
              <label class="text-center mb-3">Agregar Imagen Usuario</label>
              <div class="input-group">
                <input
                  type="file"
                  class="form-control"
                  id="image"
                  (change)="onFileChange($event)"
                  aria-describedby="inputGroupFileAddon04"
                  aria-label="Upload"
                  required
                />
              </div>
            </div>
            @if(imagenUrl){
            <div class="image-container mt-5 mb-2">
              <img
                [src]="imagenUrl"
                alt="Imagen de la prenda"
                class="centered-and-resized"
              />
            </div>
            } @else { @if(previewUrl){
            <div class="image-container mt-5 mb-2">
              <img
                [src]="previewUrl"
                alt="Imagen de la prenda"
                class="centered-and-resized"
              />
            </div>

            }@else {
            <p>Aun no se ha agregado un Logo</p>
            } }
          </div>
          }

          <div class="modal-footer">
            @if(empleado.curp !== ""){
            <button
              (click)="eliminarEmpleado(empleado.curp, $event)"
              class="btn btn-danger"
            >
              <i class="fa-solid fa-trash"></i> Eliminar
            </button>
            }
            <button type="submit" class="btn btn-primary">Guardar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal para Clientes -->
<div
  class="modal fade"
  id="editarCliente"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
  (hidden.bs.modal)="inicilizarDatosCliente()"
>
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        @if(mdCliente === 'agregar'){
        <h1 class="modal-title fs-5" id="exampleModalLabel">Agregar Cliente</h1>
        }@else {
        <h1 class="modal-title fs-5" id="exampleModalLabel">Editar Cliente</h1>
        }

        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
          #botonCerrarCliente
        ></button>
      </div>
      <div class="modal-body">
        <form #clienteForm="ngForm" (ngSubmit)="accionCliente(clienteForm)">
          @if(mdCliente === 'editar'){
          <div class="mb-3">
            <label for="curp-update-cli" class="form-label">Curp</label>
            <input
              type="text"
              class="form-control"
              id="curp-update-cli"
              name="curp"
              required
              [(ngModel)]="cliente.curp"
              disabled
            />
          </div>
          } @else {
          <div class="mb-3">
            <label for="curp-add-cli" class="form-label">Curp</label>
            <input
              type="text"
              class="form-control"
              id="curp-add-cli"
              name="curp"
              required
              [(ngModel)]="cliente.curp"
            />
          </div>
          }
          <div class="mb-3">
            <label for="nom-cliente" class="form-label">Nombre</label>
            <input
              type="text"
              class="form-control"
              id="nom-cliente"
              name="nombre"
              required
              [(ngModel)]="cliente.nombre"
            />
          </div>
          <div class="mb-3">
            <label for="paterno-cliente" class="form-label"
              >Apellido Paterno</label
            >
            <input
              type="text"
              class="form-control"
              id="paterno-cliente"
              name="apPaterno"
              required
              [(ngModel)]="cliente.apPaterno"
            />
          </div>
          <div class="mb-3">
            <label for="materno-cliente" class="form-label"
              >Apellido Materno</label
            >
            <input
              type="text"
              class="form-control"
              id="materno-cliente"
              name="apMaterno"
              required
              [(ngModel)]="cliente.apMaterno"
            />
          </div>
          <div class="mb-3">
            <label for="domicilio" class="form-label">Domicilio Actual</label>
            <input
              type="text"
              class="form-control"
              id="domicilio"
              name="domicilioActual"
              required
              [(ngModel)]="cliente.domicilio"
            />
          </div>
          <div class="mb-3">
            <label for="tel" class="form-label">Teléfono</label>
            <input
              type="tel"
              class="form-control"
              id="tel"
              name="telefono"
              [(ngModel)]="cliente.telefono"
            />
          </div>
          <div class="mb-3">
            <label for="mail" class="form-label">Correo Electrónico</label>
            <input
              type="email"
              class="form-control"
              id="mail"
              name="email"
              [(ngModel)]="cliente.email"
            />
          </div>
          <div class="mb-3">
            <label for="entrega" class="form-label">Direccion de Engrega</label>
            <input
              type="text"
              class="form-control"
              id="entrega"
              name="direccionEntrega"
              required
              [(ngModel)]="cliente.direccionEntrega"
            />
          </div>

          <div class="modal-footer">
            @if(mdCliente !== 'agregar'){
            <button
              (click)="eliminarCliente(cliente.curp, $event)"
              class="btn btn-danger"
            >
              <i class="fa-solid fa-trash"></i> Eliminar
            </button>
            }

            <button type="submit" class="btn btn-primary">Guardar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal para departamentos -->
<div
  class="modal fade"
  id="editarDepto"
  tabindex="-1"
  aria-labelledby="exampleModalLabel"
  aria-hidden="true"
  (hidden.bs.modal)="inicilizarDatosDepto()"
>
  <div class="modal-dialog modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="exampleModalLabel">Editar Clientes</h1>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
          #botonCerrarDepto
        ></button>
      </div>
      <div class="modal-body">
        <form #deptoForm="ngForm" (ngSubmit)="accionDepartamento(deptoForm)">
          <div class="mb-3">
            <label for="nombre-dep" class="form-label">Nombre</label>
            @if(mdDepto === 'agregar'){
            <input
              type="text"
              id="nombre-dep"
              name="nombre"
              class="form-control"
              [(ngModel)]="depto.nombre"
              required
            />
            } @else {
            <input
              type="text"
              id="nombre-dep"
              name="nombre"
              class="form-control"
              [(ngModel)]="depto.nombre"
              required
              disabled
            />
            }
          </div>
          <div class="mb-3">
            <label for="descripcion" class="form-label">Descripción</label>
            <textarea
              id="descripcion"
              name="descripcion"
              class="form-control"
              [(ngModel)]="depto.descripcion"
              required
            ></textarea>
          </div>
          <div class="modal-footer">
            @if(mdDepto !== 'agregar'){
            <button
              (click)="eliminarDepto(depto.nombre, $event)"
              class="btn btn-danger"
            >
              <i class="fa-solid fa-trash"></i> Eliminar
            </button>
            }

            <button type="submit" class="btn btn-primary">Guardar</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
